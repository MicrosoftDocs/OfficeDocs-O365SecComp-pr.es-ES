---
title: Detectar y solucionar la concesión de consentimiento ilegal en Office 365
ms.author: chrfox
author: chrfox
manager: laurawi
ms.date: 4/23/2018
ms.audience: ITPro
ms.topic: article
ms.collection:
- o365_security_incident_response
- M365-security-compliance
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
description: Aprenda a reconocer y corregir el consentimiento ilícito concede un ataque en Office 365.
ms.openlocfilehash: 658183b3e5a3089425312ee14c6663485e0543ce
ms.sourcegitcommit: e23b84ef4eee9cccec7205826b71ddfe9aaac2f8
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 04/28/2019
ms.locfileid: "33402958"
---
# <a name="detect-and-remediate-illicit-consent-grants-in-office-365"></a><span data-ttu-id="ef6a5-103">Detectar y solucionar la concesión de consentimiento ilegal en Office 365</span><span class="sxs-lookup"><span data-stu-id="ef6a5-103">Detect and Remediate Illicit Consent Grants in Office 365</span></span>

<span data-ttu-id="ef6a5-104">**Resumen**  Aprenda a reconocer y corregir el consentimiento ilícito concede un ataque en Office 365.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-104">**Summary**  Learn how to recognize and remediate the illicit consent grants attack in Office 365.</span></span>

## <a name="what-is-the-illicit-consent-grant-attack-in-office-365"></a><span data-ttu-id="ef6a5-105">¿Cuál es el ataque de concesión de consentimiento ilícito en Office 365?</span><span class="sxs-lookup"><span data-stu-id="ef6a5-105">What is the illicit consent grant attack in Office 365?</span></span>
<span data-ttu-id="ef6a5-106">En un ataque de consentimiento ilícito, el atacante crea una aplicación registrada de Azure que solicita acceso a datos como la información de contacto, el correo electrónico o los documentos.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-106">In an illicit consent grant attack, the attacker creates an Azure-registered application that requests access to data such as contact information, email, or documents.</span></span> <span data-ttu-id="ef6a5-107">A continuación, el atacante engaña a un usuario final para que conceda a esa aplicación el consentimiento para obtener acceso a sus datos mediante un ataque de suplantación de identidad o insertando código ilícito en un sitio web de confianza.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-107">The attacker then tricks an end user into granting that application consent to access their data either through a phishing attack, or by injecting illicit code into a trusted website.</span></span> <span data-ttu-id="ef6a5-108">Una vez que se ha concedido el consentimiento de la aplicación ilícita, tiene acceso de nivel de cuenta a los datos sin necesidad de una cuenta de la organización.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-108">After the illicit application has been granted consent, it has account-level access to data without the need for an organizational account.</span></span> <span data-ttu-id="ef6a5-109">Los pasos de corrección normales, como restablecer las contraseñas de las cuentas infringidas o requerir la autenticación multiFactor (MFA) en las cuentas, no son eficaces contra este tipo de ataque, ya que son aplicaciones de terceros y son externas a la organización.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-109">Normal remediation steps, like resetting passwords for breached accounts or requiring Multi-Factor Authentication (MFA) on accounts, are not effective against this type of attack, since these are third-party applications and are external to the organization.</span></span> <span data-ttu-id="ef6a5-110">Estos ataques aprovechan un modelo de interacción que presupone que la entidad que llama a la información es la automatización y no es una persona.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-110">These attacks leverage an interaction model which presumes the entity that is calling the information is automation and not a human.</span></span>

## <a name="what-does-an-illicit-consent-grant-attack-look-like-in-office-365"></a><span data-ttu-id="ef6a5-111">¿Qué aspecto tiene un ataque ilegal de concesión de consentimiento en Office 365?</span><span class="sxs-lookup"><span data-stu-id="ef6a5-111">What does an illicit consent grant attack look like in Office 365?</span></span>
<span data-ttu-id="ef6a5-112">Debe buscar en el **registro de auditoría** de Office 365 para encontrar signos, también denominados "indicadores de peligro" (IOC) de este ataque.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-112">You need to search the Office 365 **audit log** to find signs, also called Indicators of Compromise (IOC) of this attack.</span></span> <span data-ttu-id="ef6a5-113">Para las organizaciones con muchas aplicaciones registradas en Azure y una base de usuarios grande, el procedimiento recomendado es revisar las concesiones de consentimiento de las organizaciones cada semana.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-113">For organizations with many Azure-registered applications and a large user base, the best practice is to review your organizations consent grants on a weekly basis.</span></span>
### <a name="steps-for-finding-signs-of-this-attack"></a><span data-ttu-id="ef6a5-114">Pasos para buscar signos de este ataque</span><span class="sxs-lookup"><span data-stu-id="ef6a5-114">Steps for finding signs of this attack</span></span>
1. <span data-ttu-id="ef6a5-115">Abra el **centro de seguridad y cumplimiento** en el inquilino de Office 365.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-115">Open the **Security and Compliance Center** in your Office 365 tenant.</span></span>
2. <span data-ttu-id="ef6a5-116">Vaya al nodo de **investigación de & de búsqueda** y seleccione búsqueda de registros de **Auditoría** .</span><span class="sxs-lookup"><span data-stu-id="ef6a5-116">Navigate to the **Search & investigation** node and select **audit log** search.</span></span>
3. <span data-ttu-id="ef6a5-117">Cree una búsqueda (todas las actividades y todos los usuarios), filtre los resultados para el consentimiento de la aplicación y agregue OAuth2PermissionGrant.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-117">Create a search (all activities and all users) and filter the results for Consent to application, and Add OAuth2PermissionGrant.</span></span>
4. <span data-ttu-id="ef6a5-118">Examine las propiedades extendidas y compruebe si IsAdminContent está establecido en true.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-118">Examine the Extended Properties and check to see if IsAdminContent is set to True.</span></span>

> [!NOTE]
>  
   - <span data-ttu-id="ef6a5-119">Puede tardar hasta 30 minutos o hasta 24 horas después de que se produzca un evento para que la entrada del registro de auditoría correspondiente se muestre en los resultados de la búsqueda.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-119">It can take up to 30 minutes or up to 24 hours after an event occurs for the corresponding audit log entry to be displayed in the search results.</span></span>
   - <span data-ttu-id="ef6a5-120">La cantidad de tiempo que se retiene un registro de auditoría y se pueden buscar en el registro de auditoría depende de la suscripción de Office 365 y, específicamente, del tipo de licencia asignado a un usuario específico.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-120">The length of time that an audit record is retained and searchable in the audit log depends on your Office 365 subscription, and specifically the type of the license that is assigned to a specific user.</span></span> <span data-ttu-id="ef6a5-121">Para obtener más información, vea [registro de auditoría](search-the-audit-log-in-security-and-compliance.md).</span><span class="sxs-lookup"><span data-stu-id="ef6a5-121">For more information, see [Audit log](search-the-audit-log-in-security-and-compliance.md).</span></span>
      
<span data-ttu-id="ef6a5-122">Si este valor es true, indica que un usuario con acceso de administrador global puede haber concedido acceso general a los datos.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-122">If this value is true, it indicates that someone with Global Administrator access may have granted broad access to data.</span></span> <span data-ttu-id="ef6a5-123">Si esto es inesperado, siga los pasos para [confirmar un ataque](detect-and-remediate-illicit-consent-grants.md#confirmattack).</span><span class="sxs-lookup"><span data-stu-id="ef6a5-123">If this is unexpected, take steps to [confirm an attack](detect-and-remediate-illicit-consent-grants.md#confirmattack).</span></span>

<span data-ttu-id="ef6a5-124"><a name="confirmattack"> </a></span><span class="sxs-lookup"><span data-stu-id="ef6a5-124"></span></span>
## <a name="how-to-confirm-an-attack"></a><span data-ttu-id="ef6a5-125">Cómo confirmar un ataque</span><span class="sxs-lookup"><span data-stu-id="ef6a5-125">How to confirm an attack</span></span>
<span data-ttu-id="ef6a5-126">Si tiene una o más instancias de la IOCs enumeradas anteriormente, debe seguir investigando para confirmar que se ha producido el ataque.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-126">If you have one or more instances of the IOCs  listed above, you need to do further investigation to positively confirm that the attack occurred.</span></span> <span data-ttu-id="ef6a5-127">Puede usar cualquiera de estos tres métodos para confirmar el ataque.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-127">You can use any of these three methods to confirm the attack.</span></span>
- <span data-ttu-id="ef6a5-128">Las aplicaciones de inventario y sus permisos mediante el portal de Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-128">Inventory applications and their permissions using the Azure Active Directory portal.</span></span> <span data-ttu-id="ef6a5-129">Este método es exhaustivo, pero solo puede realizar comprobaciones en un usuario cada vez que puede llevar mucho tiempo si tiene que comprobar muchos usuarios.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-129">This method is thorough, but you can only check one user at a time which can be very time consuming if you have many users to check.</span></span>
- <span data-ttu-id="ef6a5-130">Aplicaciones de inventario y sus permisos mediante PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-130">Inventory  applications and their permissions using PowerShell.</span></span> <span data-ttu-id="ef6a5-131">Este es el método más rápido y completo, con la menor cantidad de sobrecarga.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-131">This is the fastest and most thorough method, with the least amount of overhead.</span></span>
- <span data-ttu-id="ef6a5-132">Pida a los usuarios que comprueben individualmente sus aplicaciones y permisos, y devuelvan los resultados a los administradores para corregirlos.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-132">Have your users individually check their apps and permissions and report the results back to the administrators for remediation.</span></span>

## <a name="inventory-apps-with-access-in-your-organization"></a><span data-ttu-id="ef6a5-133">Aplicaciones de inventario con acceso en la organización</span><span class="sxs-lookup"><span data-stu-id="ef6a5-133">Inventory apps with access in your organization</span></span>
<span data-ttu-id="ef6a5-134">Puede hacerlo para los usuarios con el portal de Azure Active Directory o con PowerShell, o bien hacer que los usuarios enumeren individualmente el acceso a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-134">You can do this for your users with either the Azure Active Directory Portal, or PowerShell or have your users individually enumerate their application access.</span></span>

### <a name="steps-for-using-the-azure-active-directory-portal"></a><span data-ttu-id="ef6a5-135">Pasos para usar el portal de Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="ef6a5-135">Steps for using the Azure Active Directory Portal</span></span>
<span data-ttu-id="ef6a5-136">Puede buscar las aplicaciones a las que cualquier usuario individual ha concedido permisos mediante el uso del [portal de Azure Active Directory](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="ef6a5-136">You can look up the applications to which any individual user has granted permissions by using the [Azure Active Directory Portal](https://portal.azure.com/).</span></span> 
1. <span data-ttu-id="ef6a5-137">Inicie sesión en Azure portal con derechos administrativos.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-137">Sign in to the Azure Portal with administrative rights.</span></span>
2. <span data-ttu-id="ef6a5-138">Seleccione la hoja Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-138">Select the Azure Active Directory blade.</span></span>
3. <span data-ttu-id="ef6a5-139">Seleccione **usuarios**.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-139">Select **Users**.</span></span>
4. <span data-ttu-id="ef6a5-140">Seleccione el usuario que desea revisar.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-140">Select the user that you want to review.</span></span>
5. <span data-ttu-id="ef6a5-141">Seleccione **aplicaciones**.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-141">Select **Applications**.</span></span>

<span data-ttu-id="ef6a5-142">Esto le mostrará las aplicaciones que se asignan al usuario y qué permisos tienen en el Applcations.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-142">This will show you the apps that are assigned to the user and what permissions the applcations have.</span></span>

### <a name="steps-for-having-your-users-enumerate-their-application-access"></a><span data-ttu-id="ef6a5-143">Pasos para hacer que los usuarios enumeren el acceso a la aplicación</span><span class="sxs-lookup"><span data-stu-id="ef6a5-143">Steps for having your users enumerate their application access</span></span>
<span data-ttu-id="ef6a5-144">Pida a los usuarios que https://myapps.microsoft.com vayan a y revisen su propio acceso a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-144">Have your users go to https://myapps.microsoft.com and review their own application access there.</span></span> <span data-ttu-id="ef6a5-145">Deben poder ver todas las aplicaciones con acceso, ver detalles sobre ellas (incluido el ámbito de acceso) y poder revocar los privilegios de aplicaciones sospechosas o ilícitas.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-145">They should be able to see all the apps with access, view details about them (including the scope of access), and be able to revoke privileges to suspicious or illicit apps.</span></span>

### <a name="steps-for-doing-this-with-powershell"></a><span data-ttu-id="ef6a5-146">Pasos para hacerlo con PowerShell</span><span class="sxs-lookup"><span data-stu-id="ef6a5-146">Steps for doing this with PowerShell</span></span>
<span data-ttu-id="ef6a5-147">La forma más sencilla de comprobar el ataque de consentimiento ilícito es ejecutar [Get-AzureADPSPermissions. PS1](https://gist.github.com/psignoret/41793f8c6211d2df5051d77ca3728c09), que volcarán todas las concesiones de consentimiento de OAuth y las aplicaciones de OAuth para todos los usuarios de su arrendamiento en un archivo. csv.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-147">The simplest way to verify the Illicit Consent Grant attack is to run  [Get-AzureADPSPermissions.ps1](https://gist.github.com/psignoret/41793f8c6211d2df5051d77ca3728c09), which will dump all the OAuth consent grants and OAuth apps for all users in your tenancy into one .csv file.</span></span> 

#### <a name="pre-requisites"></a><span data-ttu-id="ef6a5-148">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="ef6a5-148">Pre-requisites</span></span>
- <span data-ttu-id="ef6a5-149">La biblioteca de Azure AD PowerShell instalada.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-149">The Azure AD PowerShell library installed.</span></span>
- <span data-ttu-id="ef6a5-150">Derechos de administrador global en el espacio empresarial en el que se ejecutará el script.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-150">Global administrator rights on the tenant that the script will be run against.</span></span>
- <span data-ttu-id="ef6a5-151">Administrador local en el equipo desde el que se ejecutarán los scripts.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-151">Local Administrator on the computer from which will run the scripts.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="ef6a5-152">Se recomienda encarecidamente que requiera la autenticación multifactor en su cuenta administrativa.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-152">We highly recommend that you require multi-factor authentication on your administrative account.</span></span>  <span data-ttu-id="ef6a5-153">Este script admite la autenticación MFA.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-153">This script supports MFA authentication.</span></span>

1. <span data-ttu-id="ef6a5-154">Inicie sesión en el equipo en el que va a ejecutar el script con derechos de administrador local.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-154">Sign in to the computer that you will run the script from with local administrator rights.</span></span>
2. <span data-ttu-id="ef6a5-155">Descargue o copie el script [Get-AzureADPSPermissions. PS1](https://gist.github.com/psignoret/41793f8c6211d2df5051d77ca3728c09) de github a una carpeta desde la que se ejecutará el scruipt.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-155">Download or copy the [Get-AzureADPSPermissions.ps1](https://gist.github.com/psignoret/41793f8c6211d2df5051d77ca3728c09) script from GitHub to a folder from which you will run the scruipt.</span></span>  <span data-ttu-id="ef6a5-156">Se trata de la misma carpeta en la que se escribirá el archivo "Permissions. csv" de salida.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-156">This will be the same folder to which the output “permissions.csv” file will be written.</span></span>
3. <span data-ttu-id="ef6a5-157">Abra una instancia de PowerShell como administrador y abra la carpeta en la que guardó el script.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-157">Open a PowerShell instance as an administrator and open to the folder you saved the script to.</span></span>
4. <span data-ttu-id="ef6a5-158">Conéctese a su directorio mediante el cmdlet [Connect-AzureAD](https://docs.microsoft.com/powershell/module/azuread/connect-azuread?view=azureadps-2.0) .</span><span class="sxs-lookup"><span data-stu-id="ef6a5-158">Connect to your directory using the [Connect-AzureAD](https://docs.microsoft.com/powershell/module/azuread/connect-azuread?view=azureadps-2.0) cmdlet.</span></span>
5. <span data-ttu-id="ef6a5-159">Ejecute esta línea de comandos de PowerShell de la siguiente manera:`Get-AzureADPSPermissions.ps1 | Export-csv -path "Permissions.csv" -NoTypeInformation`</span><span class="sxs-lookup"><span data-stu-id="ef6a5-159">Run this PowerShell command line as follows: `Get-AzureADPSPermissions.ps1 | Export-csv -path "Permissions.csv" -NoTypeInformation`</span></span>

<span data-ttu-id="ef6a5-160">La secuencia de comandos genera un archivo denominado perMissions. csv.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-160">The script produces one file named Permissions.csv.</span></span> <span data-ttu-id="ef6a5-161">Siga estos pasos para buscar concesiones de permisos de aplicaciones ilícitas:</span><span class="sxs-lookup"><span data-stu-id="ef6a5-161">Follow these steps to look for illicit application permission grants:</span></span> 
1. <span data-ttu-id="ef6a5-162">En la columna ConsentType (Column G), busque el valor "AllPrinciples".</span><span class="sxs-lookup"><span data-stu-id="ef6a5-162">In the ConsentType column (column G) search for the value “AllPrinciples”.</span></span> <span data-ttu-id="ef6a5-163">El permiso AllPrincipals permite a la aplicación cliente obtener acceso al contenido de todo el inquilino.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-163">The AllPrincipals permission allows the client application to access everyone’s content in the tenancy.</span></span> <span data-ttu-id="ef6a5-164">Las aplicaciones nativas de Office 365 necesitan este permiso para funcionar correctamente.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-164">Native Office 365 applications need this permission to work correctly.</span></span> <span data-ttu-id="ef6a5-165">Todas las aplicaciones que no sean de Microsoft con este permiso deben revisarse con cuidado.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-165">Every non-Microsoft application with this permission should be reviewed carefully.</span></span>
2.  <span data-ttu-id="ef6a5-166">En la columna permiso (columna F), revise los permisos que tiene cada aplicación delegada en el contenido.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-166">In the Permission column (column F) review the permissions that each delegated application has to content.</span></span> <span data-ttu-id="ef6a5-167">Busque el permiso "leer" y "escribir" o "\*. All "permiso y revise estos detenidamente porque es posible que no sean apropiados.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-167">Look for “Read” and “Write” permission or “\*.All” permission, and review these carefully because they may not be appropriate.</span></span>
3.  <span data-ttu-id="ef6a5-168">Revise los usuarios específicos que tienen permisos concedidos.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-168">Review the specific users that have consents granted.</span></span> <span data-ttu-id="ef6a5-169">Si los usuarios de alto impacto o alto impacto tienen concedidos inadecuados, debe investigar más.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-169">If high profile or high impact users have inappropriate consents granted, you should investigate further.</span></span>
4.  <span data-ttu-id="ef6a5-170">En la columna ClientDisplayName (columna C), busque las aplicaciones que parecen sospechosas.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-170">In the ClientDisplayName column (column C) look for apps that seem suspicious.</span></span> <span data-ttu-id="ef6a5-171">Las aplicaciones con nombres mal escritos, nombres de súper Bland o nombres de sonido de hacker deben revisarse detenidamente.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-171">Apps with misspelled names, super bland names, or hacker-sounding names should be reviewed carefully.</span></span>

## <a name="determine-the-scope-of-the-attack"></a><span data-ttu-id="ef6a5-172">Determinar el ámbito del ataque</span><span class="sxs-lookup"><span data-stu-id="ef6a5-172">Determine the scope of the attack</span></span>
<span data-ttu-id="ef6a5-173">Una vez que haya terminado de inventariar el acceso a la aplicación, revise el **registro de auditoría** de Office 365 para determinar el ámbito completo de la infracción.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-173">After you have finished inventorying application access, review the Office 365 **audit log** to determine the full scope of the breach.</span></span>  <span data-ttu-id="ef6a5-174">Busque los usuarios afectados, los intervalos de tiempo en los que la aplicación ilícita tuvo acceso a su organización y los permisos que tenía la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-174">Search on the affected users, the time frames that the illicit application had access to your organization, and the permissions the app had.</span></span> <span data-ttu-id="ef6a5-175">Puede buscar en el **registro de auditoría** del [centro de seguridad y cumplimiento de Microsoft 365](https://support.office.com/article/Search-the-audit-log-in-the-Office-365-Security-Compliance-Center-0d4d0f35-390b-4518-800e-0c7ec95e946c).</span><span class="sxs-lookup"><span data-stu-id="ef6a5-175">You can search the **audit log** in the [Microsoft 365 Security and Compliance Center](https://support.office.com/article/Search-the-audit-log-in-the-Office-365-Security-Compliance-Center-0d4d0f35-390b-4518-800e-0c7ec95e946c).</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="ef6a5-176">[](https://support.office.com/article/Enable-mailbox-auditing-in-Office-365-aaca8987-5b62-458b-9882-c28476a66918) La auditoría de buzones y la [Auditoría de actividades para administradores y usuarios](https://support.office.com/article/turn-office-365-audit-log-search-on-or-off-e893b19a-660c-41f2-9074-d3631c95a014) deben estar habilitados antes del ataque para que pueda obtener esta información.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-176">[Mailbox auditing](https://support.office.com/article/Enable-mailbox-auditing-in-Office-365-aaca8987-5b62-458b-9882-c28476a66918) and [Activity auditing for admins and users](https://support.office.com/article/turn-office-365-audit-log-search-on-or-off-e893b19a-660c-41f2-9074-d3631c95a014) must have been enabled prior to the attack for you to get this information.</span></span>

## <a name="how-to-stop-and-remediate-an-illicit-consent-grant--attack"></a><span data-ttu-id="ef6a5-177">Cómo detener y corregir un ataque de concesión de consentimiento ilícito</span><span class="sxs-lookup"><span data-stu-id="ef6a5-177">How to stop and remediate an illicit consent grant  attack</span></span>
<span data-ttu-id="ef6a5-178">Una vez que haya identificado una aplicación con permisos de ilícitas, tiene varias formas de quitar ese acceso.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-178">After you have identified an application with illicit permissions, you have several ways to remove that access.</span></span>
- <span data-ttu-id="ef6a5-179">Puede revocar el permiso de la aplicación en el portal de Azure Active Directory de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="ef6a5-179">You can revoke the application's permission in the Azure Active Directory Portal by:</span></span>
    - <span data-ttu-id="ef6a5-180">Navegue al usuario afectado en la hoja de **usuario de Azure Active** Directory.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-180">Navigate to the affected user in the **Azure Active Directory User** blade.</span></span>
    - <span data-ttu-id="ef6a5-181">Seleccione **aplicaciones**.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-181">Select **Applications**.</span></span>
    - <span data-ttu-id="ef6a5-182">Seleccione la aplicación ilícita.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-182">Select the illicit application.</span></span>
    - <span data-ttu-id="ef6a5-183">Haga clic en **quitar** en el detalle.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-183">Click **Remove** in the drill down.</span></span>
- <span data-ttu-id="ef6a5-184">Puede revocar la concesión de consentimiento de OAuth con PowerShell siguiendo los pasos descritos en [Remove-AzureADOAuth2PermissionGrant](https://docs.microsoft.com/powershell/module/azuread/Remove-AzureADOAuth2PermissionGrant?view=azureadps-2.0).</span><span class="sxs-lookup"><span data-stu-id="ef6a5-184">You can revoke the OAuth consent grant with PowerShell by following the steps in [Remove-AzureADOAuth2PermissionGrant](https://docs.microsoft.com/powershell/module/azuread/Remove-AzureADOAuth2PermissionGrant?view=azureadps-2.0).</span></span>
- <span data-ttu-id="ef6a5-185">Puede revocar la asignación de roles de aplicación de servicio con PowerShell siguiendo los pasos descritos en [Remove-AzureADServiceAppRoleAssignment](https://docs.microsoft.com/powershell/module/azuread/Remove-AzureADServiceAppRoleAssignment?view=azureadps-2.0).</span><span class="sxs-lookup"><span data-stu-id="ef6a5-185">You can revoke the Service App Role Assignment with PowerShell by following the steps in [Remove-AzureADServiceAppRoleAssignment](https://docs.microsoft.com/powershell/module/azuread/Remove-AzureADServiceAppRoleAssignment?view=azureadps-2.0).</span></span>
- <span data-ttu-id="ef6a5-186">También puede deshabilitar el inicio de sesión para la cuenta afectada por completo, que a su vez deshabilitará el acceso a la aplicación a los datos de esa cuenta.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-186">You can also disable sign-in for the affected account altogether, which will in turn disable app access to data in that account.</span></span> <span data-ttu-id="ef6a5-187">Esto no es ideal para la productividad del usuario final, por supuesto, pero si está trabajando para limitar rápidamente el impacto, puede ser una corrección viable a corto plazo.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-187">This isn't ideal for the end user's productivity, of course, but if you are working to limit impact quickly, it can be a viable short-term remediation.</span></span>
- <span data-ttu-id="ef6a5-188">Puede desactivar las aplicaciones integradas para su arrendamiento.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-188">You can turn integrated applications off for your tenancy.</span></span> <span data-ttu-id="ef6a5-189">Se trata de un paso drástico que deshabilita la capacidad de los usuarios finales para conceder consentimiento en un espacio empresarial.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-189">This is a drastic step that disables the ability for end users to grant consent on a tenant-wide basis.</span></span> <span data-ttu-id="ef6a5-190">Esto evita que los usuarios concedan de forma inadvertida acceso a una aplicación malintencionada.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-190">This prevents your users from inadvertently granting access to a malicious application.</span></span> <span data-ttu-id="ef6a5-191">Esto no es muy recomendable ya que perjudica seriamente la capacidad de los usuarios de ser productivo con aplicaciones de terceros.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-191">This isn't strongly recommended as it severely impairs your users' ability to be productive with third party applications.</span></span>  <span data-ttu-id="ef6a5-192">Para ello, siga los pasos que se indican en [activar o desactivar las aplicaciones integradas](https://support.office.com/article/Turning-Integrated-Apps-on-or-off-7e453a40-66df-44ab-92a1-96786cb7fb34).</span><span class="sxs-lookup"><span data-stu-id="ef6a5-192">You can do this by following the steps in  [Turning Integrated Apps on or off](https://support.office.com/article/Turning-Integrated-Apps-on-or-off-7e453a40-66df-44ab-92a1-96786cb7fb34).</span></span>

## <a name="secure-office-365-like-a-cybersecurity-pro"></a><span data-ttu-id="ef6a5-193">Proteger Office 365 como un profesional de ciberseguridad</span><span class="sxs-lookup"><span data-stu-id="ef6a5-193">Secure Office 365 like a cybersecurity pro</span></span>
<span data-ttu-id="ef6a5-194">Su suscripción a Office 365 incluye un potente conjunto de capacidades de seguridad que puede usar para proteger sus datos y los usuarios.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-194">Your Office 365 subscription comes with a powerful set of security capabilities that you can use to protect your data and your users.</span></span>  <span data-ttu-id="ef6a5-195">Use el [Plan de seguridad de Office 365: principales prioridades para los primeros 30 días, 90 días y en adelante](https://support.office.com/article/office-365-security-roadmap-top-priorities-for-the-first-30-days-90-days-and-beyond-28c86a1c-e4dd-4aad-a2a6-c768a21cb352) para implementar las prácticas recomendadas de Microsoft para proteger su espacio empresarial de Office 365.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-195">Use the [Office 365 security roadmap: Top priorities for the first 30 days, 90 days, and beyond](https://support.office.com/article/office-365-security-roadmap-top-priorities-for-the-first-30-days-90-days-and-beyond-28c86a1c-e4dd-4aad-a2a6-c768a21cb352) to implement Microsoft recommended best practices for securing your Office 365 tenant.</span></span>
- <span data-ttu-id="ef6a5-196">Tareas a realizar en los primeros 30 días.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-196">Tasks to accomplish in the first 30 days.</span></span>  <span data-ttu-id="ef6a5-197">Estas tienen un efecto inmediato y de bajo impacto para los usuarios.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-197">These have immediate affect and are low-impact to your users.</span></span>
- <span data-ttu-id="ef6a5-198">Tareas para llevar a cabo en 90 días.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-198">Tasks to accomplish in 90 days.</span></span> <span data-ttu-id="ef6a5-199">Estas tareas necesitan un poco más de tiempo para planearlas e implementarlas, pero mejoran considerablemente el nivel de seguridad.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-199">These take a bit more time to plan and implement but greatly improve your security posture.</span></span>
- <span data-ttu-id="ef6a5-200">Más de 90 días.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-200">Beyond 90 days.</span></span> <span data-ttu-id="ef6a5-201">Estas mejoras se crean en el trabajo de los 90 primeros días.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-201">These enhancements build in your first 90 days work.</span></span>

## <a name="see-also"></a><span data-ttu-id="ef6a5-202">Vea también:</span><span class="sxs-lookup"><span data-stu-id="ef6a5-202">See also:</span></span>
- <span data-ttu-id="ef6a5-203">Una [aplicación inesperada en la lista de mis aplicaciones](https://docs.microsoft.com/azure/active-directory/application-access-unexpected-application) dirige a los administradores a través de diversas acciones que quizás deseen realizar después de la realización de que hay aplicaciones inesperadas con acceso a los datos.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-203">[Unexpected application in my applications list](https://docs.microsoft.com/azure/active-directory/application-access-unexpected-application)  walks administrators through various actions they may want to take after realizing there are unexpected applications with access to data.</span></span>
- <span data-ttu-id="ef6a5-204">[Integración de aplicaciones con Azure Active Directory]  (https://docs.microsoft.com/azure/active-directory/active-directory-apps-permissions-consent) es una introducción de alto nivel de consentimiento y permisos.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-204">[Integrating applications with Azure Active Directory]  (https://docs.microsoft.com/azure/active-directory/active-directory-apps-permissions-consent)  is a high-level overview of consent and permissions.</span></span>  <span data-ttu-id="ef6a5-205">Preste especial atención a la [información general de la sección del marco de consentimiento](https://docs.microsoft.com/azure/active-directory/develop/active-directory-integrating-applications#overview-of-the-consent-framework) .</span><span class="sxs-lookup"><span data-stu-id="ef6a5-205">Pay particular attention to the [Overview of the consent framework](https://docs.microsoft.com/azure/active-directory/develop/active-directory-integrating-applications#overview-of-the-consent-framework) section.</span></span>
- <span data-ttu-id="ef6a5-206">[Problemas en el desarrollo de la aplicación](https://docs.microsoft.com/azure/active-directory/active-directory-application-dev-development-content-map) proporciona vínculos a varios artículos relacionados con el consentimiento.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-206">[Problems developing my application](https://docs.microsoft.com/azure/active-directory/active-directory-application-dev-development-content-map) provides links to various consent related articles.</span></span>
- <span data-ttu-id="ef6a5-207">La [aplicación y los objetos de entidad de servicio de Azure Active Directory (Azure ad)](https://docs.microsoft.com/azure/active-directory/develop/active-directory-application-objects) proporcionan una introducción a los objetos de la entidad de servicio y la aplicación que son fundamentales para el modelo de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-207">[Application and service principal objects in Azure Active Directory (Azure AD)](https://docs.microsoft.com/azure/active-directory/develop/active-directory-application-objects) provides an overview of the Application and Service principal objects that are core to the application model.</span></span>
- <span data-ttu-id="ef6a5-208">[Manage Access to apps](https://docs.microsoft.com/azure/active-directory/active-directory-managing-access-to-apps) es una introducción a las funcionalidades que los administradores tienen para administrar el acceso de los usuarios a las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="ef6a5-208">[Manage access to apps](https://docs.microsoft.com/azure/active-directory/active-directory-managing-access-to-apps) is an overview of the capabilities that administrators have to manage user access to apps.</span></span>
